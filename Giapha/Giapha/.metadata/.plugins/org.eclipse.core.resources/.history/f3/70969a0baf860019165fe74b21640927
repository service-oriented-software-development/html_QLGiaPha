package Controller.web;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import BLL.UserBLL;
import Common.ConnectionPool;
import Common.ConnectionPoolImpl;
import Model.UserModel;
import Utils.HttpUtil;
import DAO.user.*;;

//@WebServlet(urlPatterns = {"/home", "/admin"})
@WebServlet("/home")
public class Home extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private static final String CONTENT_TYPE = "text/html; charset=UTF-8";

	/**
	 * @see HttpServlet#HttpServlet()
	 */
	public Home() {
		super();
		// TODO Auto-generated constructor stub
	}

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse
	 *      response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		response.setContentType(CONTENT_TYPE);
		PrintWriter out = response.getWriter();
		
		out.print("<%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\"");
		out.print("pageEncoding=\"UTF-8\"%>");
	out.print("<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\"%>");
	out.print("<!DOCTYPE html>");
	out.print("<html>");
	out.print("<head>");
	out.print("<meta charset=\"utf-8\">");
	out.print("<meta name=\"viewport\"");
		out.print("content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">");
	out.print("");
	out.print("<link rel=\"stylesheet\" href=\"<c:url value='/adcss/bootstrap.min.css'/>\" />");
	out.print("");
	out.print("<link href=\"<c:url value='/adcss/bootstrap.css'/>\" rel=\"stylesheet\">");
	out.print("<link href=\"<c:url value='/adcss/bootstrap.icon-large.min.css'/>\" rel=\"stylesheet\" />");
	out.print("<link rel=\"stylesheet\" href=\"<c:url value='/adcss/all.css'/>\" />");
	out.print("");
	out.print("<meta");
		out.print("content=\"giapha, giatoc, tocpha, giaphả, giatộc, gia pha, gia toc, toc pha, gia phả, gia tộc, tộc phả,caygiapha, cay gia pha, cay gia dinh\"");
		out.print("name=keywords>");
	out.print("<meta property=\"og:url\" content=\"\" />");
	out.print("<meta property=\"og:title\" content=\"Việt Nam Gia phả\" />");
	out.print("<meta property=\"og:description\"");
		out.print("content=\"Nơi lưu trữ Gia phả của người Việt Nam\" />");
	out.print("<meta property=\"og:image\" />");
	out.print("");
	out.print("<meta property=\"og:type\" content=\"\" />");
	out.print("<title>Gia Phả Online</title>");
	out.print("");
	out.print("");
	out.print("");
	out.print("</head>");
	out.print("<body>");
		out.print("<a href='<c:url value=\"/dangnhap?action=login\"/>'>Đăng nhập</a>");
		out.print("<a href='<c:url value=\"/familytree\"/>'>family tree</a>");
		out.print("<nav class=\"navbar navbar-dark bg-dark navbar-expand-sm\">");
		  out.print("<div class=\"container\">");
			out.print("<a class=\"navbar-brand\" href=\"#\">");
				out.print("<img src=\"<c:url value='/adimgs/exit.png'/>\" alt=\"Gia phả online\"/>Gia Phả Online");
			out.print("</a>");
			out.print("<button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbar-list-11\" aria-controls=\"navbarNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">");
			  out.print("<span class=\"navbar-toggler-icon\"></span>");
			out.print("</button>");
			out.print("<div class=\"collapse navbar-collapse\" id=\"navbar-list-11\">");
			  out.print("<ul class=\"navbar-nav ml-auto\">");
				out.print("<li class=\"nav-item\">");
				  out.print("<a class=\"nav-link\" href=\"#\" >Gia phả là gì</a>");
				out.print("</li>");
				out.print("<li class=\"nav-item\">");
				  out.print("<a class=\"nav-link\" href=\"#\" >Hướng dẫn làm gia phả</a>");
				out.print("</li>");
				out.print("<li class=\"nav-item\">");
	out.print("<a class=\"nav-link\" href=\"#\" onclick=\"open_login()\">Đăng nhập</a>			");
	out.print("			  ");
				out.print("</li>");
			  out.print("</ul>");
			out.print("</div>");
		  out.print("</div>");
		out.print("</nav>");
		out.print("<!-- HEADER NAV - END -->");
		out.print("<nav class=\"navbar navbar-light bg-light navbar-expand-sm\">");
			out.print("<div class=\"container\">");
				out.print("<div class=\"input-group\">");
					out.print("<input type=\"text\" id=\"name\" class=\"form-control\" placeholder=\"Tìm theo tên tộc họ\" aria-label=\"Tìm\" aria-describedby=\"button-addon2\">");
					out.print("<div class=\"input-group-append\">");
						out.print("<button class=\"btn btn-info\" type=\"button\" onclick=\"loadGp()\" id=\"search_id\">Tìm kiếm</button>");
					out.print("</div>");
				out.print("</div>");
			out.print("</div>");
		out.print("</nav>");
	out.print("");
	out.print("	");
	out.print("	");
		out.print("<div class=\"container-fluid content-row\" id=\"list_gp\">");
		out.print("</div>");
		out.print("<nav class=\"navbar navbar-dark bg-dark navbar-expand-sm\">");
		  out.print("<div class=\"container\">");
			out.print("<p style=\"color:white\">Dự án lưu trữ gia phả của người Việt</p>");
		  out.print("</div>");
		out.print("</nav>");
	    out.print("<script src=\"<c:url value='adjs/jquery-3.2.1.min.js'/>\"></script> ");
	    out.print("<script src=\"<c:url value='adjs/popper.min.js'/>\"></script>");
	    out.print("<script src=\"<c:url value='adjs/bootstrap.min.js'/>\"></script>  ");
	    out.print("<script src=\"<c:url value='adjs/login.js'/>\"></script>  ");
	out.print("<script type=\"text/javascript\">");
		out.print("function ucFirstAllWords( str )");
		out.print("{");
			out.print("var pieces = str.split(\" \");");
			out.print("for ( var i = 0; i < pieces.length; i++ )");
			out.print("{");
				out.print("var j = pieces[i].charAt(0).toUpperCase();");
				out.print("pieces[i] = j + pieces[i].substr(1);");
			out.print("}");
			out.print("return pieces.join(\" \");");
		out.print("}");
	out.print("	");
		out.print("$(document).ready(function() {");
			out.print("$('#search_id').keypress(function(event){");
				out.print("var keycode = (event.keyCode ? event.keyCode : event.which);");
				out.print("if(keycode == '13' ||keycode ==13){");
				   out.print("loadGp();");
				out.print("}");
			out.print("});");
			out.print("$( \"#username\" )");
			  out.print(".blur(function() {");
				  out.print("$( \"#username\" ).val( \"\"+$( \"#username\" ).val().trim().toLowerCase() );");
				  out.print("checku();");
			  out.print("});");
			out.print("$( \"#email\" )");
			  out.print(".blur(function() {");
				  out.print("checke();");
			  out.print("});");
			out.print("$( \"#loginid\" )");
			  out.print(".blur(function() {");
				  out.print("$( \"#loginid\" ).val( \"\"+$( \"#loginid\" ).val().trim().toLowerCase() );");
			  out.print("});");
			out.print("$( \"#fullname\" )");
			  out.print(".blur(function() {");
				  out.print("$( \"#fullname\" ).val( \"\"+ ucFirstAllWords( $( \"#fullname\" ).val().trim()) );");
			  out.print("});");
	out.print("loadGp();");
		out.print("});");
	out.print("	");
		out.print("function loadGp(){");
			out.print("$(\"#list_gp\").html('<img src=\"<c:url value='/adimgs/loading1.gif'/>\">');");
			out.print("//");
			out.print("var name = $(\"#name\").val();");
			out.print("var sendInfo = {");
				out.print("name: name,");
				out.print("max:3000,");
			out.print("};");
	        out.print("// ajax");
	        out.print("$.ajax({");
				out.print("url : \"load.php\",");
	            out.print("type : \"POST\",");
	            out.print("//dataType: \"JSON\",");
				out.print("data: sendInfo,");
	            out.print("success: function(data) {");
	                out.print("//if success reload ajax table");
					out.print("//console.log( data );");
					out.print("$(\"#list_gp\").html(data);");
					out.print("FB.XFBML.parse();");
	            out.print("},");
	            out.print("error: function(jqXHR, textStatus, errorThrown) {");
					out.print("alert('Error '+ textStatus);");
	            out.print("}");
	        out.print("});");
		out.print("}");
		out.print("function forget_password(){");
			out.print("alert(\"Chỗ ID, bạn nhập vào email của bạn.\nSau đó hệ thống sẽ tự gửi về đó password mới.\");");
	out.print("		");
			out.print("var username = $(\"#loginid\").val().trim();");
			out.print("var error = 0;");
			out.print("if( username.length<2 ){");
				out.print("$('[name=\"loginid\"]').parent().parent().addClass('has-error');");
				out.print("$('[name=\"loginid\"]').next().text(\"Nhập vào [loginid] để lấy lại password\");");
				out.print("error = 1;");
			out.print("}");
			out.print("else{");
				out.print("if( isEmail(username)==false ){");
					out.print("$('[name=\"loginid\"]').parent().parent().addClass('error');");
					out.print("$('[name=\"loginid\"]').next().text(\"hoặc nhập vào [email] để lấy lại password\");");
					out.print("error = 1;");
				out.print("}");
				out.print("else{");
					out.print("$('[name=\"loginid\"]').parent().parent().attr('class','').addClass('form-group');");
					out.print("$('[name=\"loginid\"]').next().text(\"\");");
				out.print("}");
			out.print("}");
			out.print("if(error ===1 ){");
				out.print("$(\"#login_msg\").html('Có lỗi');");
				out.print("return;");
			out.print("}");
			out.print("$(\"#login_msg\").html('<img src=\"<c:url value='/adimgs/loading1.gif'/>\">');");
	out.print("");
			out.print("// ajax");
	        out.print("$.ajax({");
				out.print("url : \"login.php\",");
	            out.print("type : \"POST\",");
				out.print("data: {");
					out.print("username:username,");
					out.print("func:\"forget\"");
				out.print("},");
	            out.print("success: function(datastr) {");
					out.print("data = JSON.parse(datastr);");
					out.print("alert(data.reason);");
					out.print("$(\"#pass\").val(\"\");");
					out.print("$(\"#login_msg\").html('');");
	            out.print("},");
	            out.print("error: function(jqXHR, textStatus, errorThrown) {");
					out.print("alert('Error '+ textStatus);");
	            out.print("}");
	        out.print("});");
		out.print("}");
	out.print("	");
		out.print("function open_login()");
		out.print("{");
			out.print("$('#modal_form_register').modal('hide'); // show bootstrap modal");
			out.print("$('#form')[0].reset(); // reset form on modals");
			out.print("$('.form-group').removeClass('has-error'); // clear error class");
			out.print("$('#modal_form_login').modal('show'); // show bootstrap modal");
			out.print("$(\"#loginid\").focus();");
		out.print("}");
	out.print("	");
		out.print("function logout()");
		out.print("{");
			out.print("// ajax");
	        out.print("$.ajax({");
				out.print("url : \"login.php\",");
	            out.print("type : \"POST\",");
				out.print("data: {func:\"logout\"},");
	            out.print("success: function(datastr) {");
					out.print("data = JSON.parse(datastr);");
					out.print("if( data.status=='ok'){");
						out.print("location.reload();");
					out.print("}");
	            out.print("},");
	            out.print("error: function(jqXHR, textStatus, errorThrown) {");
					out.print("alert('Error '+ textStatus);");
	            out.print("}");
	        out.print("});");
		out.print("}");
		out.print("function isEmail(email) {");
			out.print("var regex = \"\";");
			out.print("return regex.test(email);");
		out.print("}");
		out.print("function open_register()");
		out.print("{");
			out.print("$('#modal_form_login').modal('hide'); // show bootstrap modal");
			out.print("$('.form-group').removeClass('has-error'); // clear error class");
			out.print("$('#modal_form_register').modal('show'); // show bootstrap modal");
			out.print("$(\"#username\").focus();");
		out.print("}");
	out.print("	");
		out.print("var error = 0;");
		out.print("function register()");
		out.print("{");
			out.print("//console.log(\"Đang ký\");");
			out.print("var username = $(\"#username\").val().trim();");
			out.print("var password = $(\"#password\").val().trim();");
			out.print("var email = $(\"#email\").val().trim();");
			out.print("var fullname = $(\"#fullname\").val().trim();");
			out.print("//");
			out.print("if( error > 1 ){");
				out.print("return;");
			out.print("}");
			out.print("if( username.length<5 ){");
				out.print("$('[name=\"username\"]').parent().parent().addClass('error');");
				out.print("$('[name=\"username\"]').next().text(\"[username] không để trống, >5 ký tự\");");
				out.print("error = 1;");
			out.print("}");
			out.print("else{");
				out.print("$('[name=\"username\"]').parent().parent().attr('class','').addClass('form-group');");
				out.print("$('[name=\"username\"]').next().text(\"\");");
			out.print("}");
			out.print("if( password.length<8 ){");
				out.print("$('[name=\"password\"]').parent().parent().addClass('error');");
				out.print("$('[name=\"password\"]').next().text(\"[password] không để trống, >=8 ký tự\");");
				out.print("error = 1;");
			out.print("}");
			out.print("else{");
				out.print("$('[name=\"password\"]').parent().parent().attr('class','').addClass('form-group');");
				out.print("$('[name=\"password\"]').next().text(\"\");");
			out.print("}");
			out.print("if( isEmail(email)==false ){");
				out.print("$('[name=\"email\"]').parent().parent().addClass('error');");
				out.print("$('[name=\"email\"]').next().text(\"[email] phải đúng\");");
				out.print("error = 1;");
			out.print("}");
			out.print("else{");
				out.print("$('[name=\"email\"]').parent().parent().attr('class','').addClass('form-group');");
				out.print("$('[name=\"email\"]').next().text(\"\");");
			out.print("}");
	out.print("");
			out.print("if( fullname.length<5 ){");
				out.print("$('[name=\"fullname\"]').parent().parent().addClass('has-error');");
				out.print("$('[name=\"fullname\"]').next().text(\"[fullname] không để trống, 10 ký tự\");");
				out.print("error = 1;");
			out.print("}");
			out.print("else{");
				out.print("$('[name=\"fullname\"]').parent().parent().attr('class','').addClass('form-group');");
				out.print("$('[name=\"fullname\"]').next().text(\"\");");
			out.print("}");
			out.print("if(error ==1 ){");
				out.print("$(\"#register_msg\").html('Có lỗi nhập thông tin');");
				out.print("return;");
			out.print("}");
			out.print("$(\"#register_msg\").html('<img src=\"<c:url value='/adimgs/loading1.gif'/>\">');");
	out.print("		");
			out.print("var sendInfo = {");
				out.print("password: password,");
				out.print("username:username,");
				out.print("email:email,");
				out.print("fullname:fullname,");
				out.print("func:\"register\",");
			out.print("};");
			out.print("// ajax");
	        out.print("$.ajax({");
				out.print("url : \"login.php\",");
	            out.print("type : \"POST\",");
				out.print("data: sendInfo,");
	            out.print("success: function(datastr) {");
					out.print("data = JSON.parse(datastr);");
					out.print("$(\"#register_msg\").html(data.reason);");
					out.print("if( data.status=='ok'){");
						out.print("$('#modal_form_register').modal('hide'); // show bootstrap modal");
						out.print("open_login();");
					out.print("}");
	            out.print("},");
	            out.print("error: function(jqXHR, textStatus, errorThrown) {");
					out.print("$(\"#register_msg\").html('Có lỗi đăng ký thành viên');");
					out.print("alert('Error '+ textStatus);");
	            out.print("}");
	        out.print("});");
		out.print("}");
		out.print("function checke()");
		out.print("{");
			out.print("//console.log(\"Đang ký\");");
			out.print("$(\"#register_msg\").html('<img src=\"<c:url value='/adimgs/loading1.gif'/>\">');");
			out.print("var email = $(\"#email\").val().trim();");
			out.print("if( isEmail(email)==false ){");
				out.print("$('[name=\"email\"]').parent().parent().addClass('error');");
				out.print("$('[name=\"email\"]').next().text(\"[email] phải đúng\");");
				out.print("error = 1;");
			out.print("}");
			out.print("else{");
				out.print("$('[name=\"email\"]').parent().parent().attr('class','').addClass('form-group');");
				out.print("$('[name=\"email\"]').next().text(\"\");");
			out.print("}");
			out.print("if(error ==1 ){");
				out.print("$(\"#register_msg\").html('Có lỗi nhập thông tin');");
				out.print("return;");
			out.print("}");
			out.print("var sendInfo = {");
				out.print("email:email,");
				out.print("func:\"checke\",");
			out.print("};");
			out.print("// ajax");
	        out.print("$.ajax({");
				out.print("url : \"login.php\",");
	            out.print("type : \"POST\",");
				out.print("data: sendInfo,");
	            out.print("success: function(datastr) {");
					out.print("data = JSON.parse(datastr);");
					out.print("if( data.status>0){");
						out.print("$('[name=\"email\"]').parent().parent().addClass('error');");
						out.print("$('[name=\"email\"]').next().text(\"[email] có lỗi. Email đã có người dùng\");");
						out.print("error = 2;");
					out.print("}");
					out.print("else{");
						out.print("$('[name=\"email\"]').parent().parent().attr('class','').addClass('form-group');");
						out.print("$('[name=\"email\"]').next().text(\"\");");
						out.print("error = 0;");
					out.print("}");
					out.print("$(\"#register_msg\").html('');");
	            out.print("},");
	            out.print("error: function(jqXHR, textStatus, errorThrown) {");
					out.print("alert('Error '+ textStatus);");
	            out.print("}");
	        out.print("});");
		out.print("}");
		out.print("function checku()");
		out.print("{");
			out.print("//console.log(\"Đang ký\");");
			out.print("$(\"#register_msg\").html('<img src=\"<c:url value='/adimgs/loading1.gif'/>\">');");
			out.print("var username = $(\"#username\").val().trim();");
			out.print("var email = $(\"#email\").val().trim();");
			out.print("if( username.length<5 || username.indexOf(\" \")>-1 ){");
				out.print("$('[name=\"username\"]').parent().parent().addClass('error');");
				out.print("$('[name=\"username\"]').next().text(\"[username] không để trống, >5 ký tự\");");
				out.print("error = 1;");
			out.print("}");
			out.print("else{");
				out.print("$('[name=\"username\"]').parent().parent().attr('class','').addClass('form-group');");
				out.print("$('[name=\"username\"]').next().text(\"\");");
			out.print("}");
			out.print("if(error ==1 ){");
				out.print("$(\"#register_msg\").html('Có lỗi nhập thông tin');");
				out.print("return;");
			out.print("}");
			out.print("var sendInfo = {");
				out.print("username:username,");
				out.print("func:\"checku\",");
			out.print("};");
			out.print("// ajax");
	        out.print("$.ajax({");
				out.print("url : \"login.php\",");
	            out.print("type : \"POST\",");
				out.print("data: sendInfo,");
	            out.print("success: function(datastr) {");
					out.print("data = JSON.parse(datastr);");
					out.print("if( data.status>0){");
						out.print("$('[name=\"username\"]').parent().parent().addClass('error');");
						out.print("$('[name=\"username\"]').next().text(\"[username] đã có người chọn\");");
						out.print("error = 3;");
					out.print("}");
					out.print("else{");
						out.print("$('[name=\"username\"]').parent().parent().attr('class','').addClass('form-group');");
						out.print("$('[name=\"username\"]').next().text(\"\");");
						out.print("error = 0;");
					out.print("}");
					out.print("$(\"#register_msg\").html('');");
	            out.print("},");
	            out.print("error: function(jqXHR, textStatus, errorThrown) {");
					out.print("alert('Error '+ textStatus);");
	            out.print("}");
	        out.print("});");
		out.print("}");
		out.print("function open_reset_password(code){");
			out.print("$(\"#reset_code\").val(\"\"+code);");
			out.print("$('#modal_form_reset_password').modal('show');");
		out.print("}");
		out.print("function reset_password()");
		out.print("{");
			out.print("var code = $(\"#reset_code\").val().trim();");
			out.print("var reset_pass = $(\"#reset_pass\").val().trim();");
			out.print("var reset_pass1 = $(\"#reset_pass1\").val().trim();");
			out.print("var error = 0;");
			out.print("if( reset_pass!=reset_pass1 ){");
				out.print("$('[name=\"reset_pass1\"]').parent().parent().addClass('has-error');");
				out.print("$('[name=\"reset_pass1\"]').next().text(\"Phải nhập lại password 2 lần giống nhau\");");
				out.print("error = 1;");
			out.print("}");
			out.print("else{");
				out.print("$('[name=\"reset_pass1\"]').parent().parent().attr('class','').addClass('form-group');");
				out.print("$('[name=\"reset_pass1\"]').next().text(\"\");");
			out.print("}");
			out.print("if(error ===1 ){");
				out.print("$(\"#reset_msg\").html('Có lỗi');");
				out.print("return;");
			out.print("}");
			out.print("$(\"#reset_msg\").html('<img src=\"<c:url value='/adimgs/loading1.gif'/>\">');");
			out.print("var sendInfo = {");
				out.print("code: code,");
				out.print("reset_pass:reset_pass,");
				out.print("reset_pass1:reset_pass1,");
				out.print("func:\"reset_password\",");
			out.print("};");
			out.print("// ajax");
	        out.print("$.ajax({");
				out.print("url : \"login.php\",");
	            out.print("type : \"POST\",");
				out.print("data: sendInfo,");
	            out.print("success: function(datastr) {");
					out.print("data = JSON.parse(datastr);");
					out.print("$(\"#reset_msg\").html(data.reason);");
					out.print("if( data.status=='ok'){");
						out.print("alert(\"Thành công: \" + data.reason);");
						out.print("$('#modal_form_reset_password').modal('hide'); // show bootstrap modal");
						out.print("$('#modal_form_login').modal('show'); // show bootstrap modal");
						out.print("window.location.href = \"http://www.vietnamgiapha.com/m\";");
					out.print("}");
					out.print("else{");
						out.print("alert(\"Có lỗi: \" + data.reason);");
					out.print("}");
	            out.print("},");
	            out.print("error: function(jqXHR, textStatus, errorThrown) {");
					out.print("$(\"#reset_msg\").html('Có lỗi');");
					out.print("alert('Error '+ textStatus);");
	            out.print("}");
	        out.print("});");
		out.print("}");
	out.print("</script>");
	out.print("<!-- Bootstrap modal -->");
	    out.print("<div class=\"modal fade\" id=\"modal_form_login\" tabindex=\"-1\" role=\"dialog\">");
	        out.print("<div class=\"modal-dialog\">");
	            out.print("<div class=\"modal-content\">");
	                out.print("<div class=\"modal-header\">");
						out.print("<h4 class=\"modal-title\" id=\"largeModalLabel\">ĐĂNG NHẬP</h4>");
					out.print("</div>");
	                out.print("<div class=\"modal-body form\">");
						out.print("<div id=\"login_msg\"></div>");
	                    out.print("<form id=\"form\" data-parsley-validate=\"\" class=\"form-horizontal form-label-left\" novalidate=\"\">");
							out.print("<div class=\"form-group\">");
								out.print("<input type=\"text\" name=\"loginid\" id=\"loginid\" class=\"form-control\" placeholder=\"ID\" required autofocus>");
								out.print("<span class=\"help-block\"></span>");
							out.print("</div>");
							out.print("<div class=\"form-group form-float\">");
								out.print("<input type=\"password\" name=\"pass\" id=\"pass\" class=\"form-control\" value=\"\" placeholder=\"Password\">");
								out.print("<span class=\"help-block\"></span>");
							out.print("</div>");
	                    out.print("</form>");
						out.print("<div>");
							out.print("<button type=\"button\" class=\"btn btn-lg btn-primary btn-block text-uppercase\" onclick=\"login()\" >ĐĂNG NHẬP</button>");
							out.print("<hr class=\"my-4\">");
							out.print("<button type=\"button\" class=\"btn btn-lg btn-info btn-block text-uppercase\" onclick=\"open_register()\" >Đăng ký mới</button>");
							out.print("<button type=\"button\" class=\"btn btn-lg btn-info btn-block text-uppercase\" onclick=\"forget_password()\" >Quên password</button>");
							out.print("<button class=\"btn btn-lg btn-info btn-block text-uppercase\" data-dismiss=\"modal\" type=\"button\"> Bỏ qua</button>");
						out.print("</div>");
	                out.print("</div>");
	            out.print("</div><!-- /.modal-content -->");
	        out.print("</div><!-- /.modal-dialog -->");
	    out.print("</div><!-- /.modal -->");
	out.print("	");
		out.print("<div class=\"modal fade\" id=\"modal_form_register\" tabindex=\"-1\" role=\"dialog\">");
	        out.print("<div class=\"modal-dialog\">");
	            out.print("<div class=\"modal-content\">");
	                out.print("<div class=\"modal-header\">");
						out.print("<h4 class=\"modal-title\" id=\"largeModalLabel\">ĐĂNG KÝ THÀNH VIÊN</h4>");
					out.print("</div>");
	                out.print("<div class=\"modal-body form\">");
						out.print("<div id=\"register_msg\"></div>");
	                    out.print("<form id=\"form1\" data-parsley-validate=\"\" class=\"form-horizontal form-label-left\" novalidate=\"\">");
							out.print("<div class=\"col-sm-12\">");
								out.print("<div class=\"form-group form-float\">");
									out.print("<div class=\"form-line\">");
										out.print("<input type=\"text\" name=\"username\" id=\"username\" class=\"form-control\" placeholder=\"Email hoặc ID\">");
										out.print("<span class=\"help-block\"></span>");
									out.print("</div>");
								out.print("</div>");
							out.print("</div>");
							out.print("<div class=\"col-sm-12\">");
								out.print("<div class=\"form-group form-float\">");
									out.print("<div class=\"form-line\">");
										out.print("<input type=\"text\" name=\"password\" id=\"password\" class=\"form-control\" value=\"\" placeholder=\"Password\">");
										out.print("<span class=\"help-block\"></span>");
									out.print("</div>");
								out.print("</div>");
							out.print("</div>");
							out.print("<div class=\"col-sm-12\">");
								out.print("<div class=\"form-group form-float\">");
									out.print("<div class=\"form-line\">");
										out.print("<input type=\"text\" name=\"email\" id=\"email\" class=\"form-control\" placeholder=\"Email của bạn.\">");
										out.print("<span class=\"help-block\"></span>");
									out.print("</div>");
								out.print("</div>");
							out.print("</div>");
							out.print("<div class=\"col-sm-12\">");
								out.print("<div class=\"form-group form-float\">");
									out.print("<div class=\"form-line\">");
										out.print("<input type=\"text\" name=\"fullname\" id=\"fullname\" class=\"form-control\" value=\"\" placeholder=\"Tên đầy đủ\">");
										out.print("<span class=\"help-block\"></span>");
									out.print("</div>");
								out.print("</div>");
							out.print("</div>");
	                    out.print("</form>");
						out.print("<div>");
							out.print("<button type=\"button\" class=\"btn btn-lg btn-primary btn-block text-uppercase\" onclick=\"register()\" >Đăng ký mới</button>");
							out.print("<hr class=\"my-4\">");
							out.print("<button type=\"button\" class=\"btn btn-lg btn-info btn-block text-uppercase\" onclick=\"open_login()\" >Đăng nhập</button>");
							out.print("<button class=\"btn btn-lg btn-info btn-block text-uppercase\" data-dismiss=\"modal\" type=\"button\"> Bỏ qua</button>");
						out.print("</div>");
	                out.print("</div>");
	            out.print("</div><!-- /.modal-content -->");
	        out.print("</div><!-- /.modal-dialog -->");
	    out.print("</div><!-- /.modal -->");
		out.print("<div class=\"modal fade\" id=\"modal_form_reset_password\" tabindex=\"-1\" role=\"dialog\">");
	        out.print("<div class=\"modal-dialog\">");
	            out.print("<div class=\"modal-content\">");
	                out.print("<div class=\"modal-header\">");
						out.print("<h4 class=\"modal-title\" id=\"largeModalLabel\">RESET PASSWORD</h4>");
					out.print("</div>");
	                out.print("<div class=\"modal-body form\">");
						out.print("<div id=\"login_msg\"></div>");
	                    out.print("<form id=\"form\" data-parsley-validate=\"\" class=\"form-horizontal form-label-left\" novalidate=\"\">");
							out.print("<div class=\"col-sm-12\">");
								out.print("<div class=\"form-group form-float\">");
									out.print("<div class=\"form-line\">");
										out.print("<input type=\"text\" name=\"reset_code\" id=\"reset_code\" class=\"form-control\" readonly>");
										out.print("<span class=\"help-block\"></span>");
									out.print("</div>");
								out.print("</div>");
							out.print("</div>");
							out.print("<div class=\"col-sm-12\">");
								out.print("<div class=\"form-group form-float\">");
									out.print("<div class=\"form-line\">");
										out.print("<input type=\"text\" name=\"reset_pass\" id=\"reset_pass\" class=\"form-control\" value=\"\" placeholder=\"Password mới\">");
										out.print("<span class=\"help-block\"></span>");
									out.print("</div>");
								out.print("</div>");
							out.print("</div>");
							out.print("<div class=\"col-sm-12\">");
								out.print("<div class=\"form-group form-float\">");
									out.print("<div class=\"form-line\">");
										out.print("<input type=\"text\" name=\"reset_pass1\" id=\"reset_pass1\" class=\"form-control\" value=\"\" placeholder=\"Password nhập lại\">");
										out.print("<span class=\"help-block\"></span>");
									out.print("</div>");
								out.print("</div>");
							out.print("</div>");
	                    out.print("</form>");
						out.print("<div>");
							out.print("<button type=\"button\" class=\"btn btn-lg btn-primary btn-block text-uppercase\" onclick=\"reset_password()\" ><i class=\"fa fa-sign-in\"></i> Lưu password mới</button>");
						out.print("</div>");
	                out.print("</div>");
	            out.print("</div><!-- /.modal-content -->");
	        out.print("</div><!-- /.modal-dialog -->");
	    out.print("</div><!-- /.modal -->");
	out.print("</body>");
	out.print("</html>");
		
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse
	 *      response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		ConnectionPool cp = (ConnectionPool) getServletContext().getAttribute("Pool");
		UserBLL us = new UserBLL(cp);
		if (cp == null) {
			getServletContext().setAttribute("Pool", us.getCP());
		}
		String username = request.getParameter("loginid");
		String userpass = request.getParameter("pass");
		if (username != null && userpass != null) {
			username = username.trim();
			userpass = userpass.trim();
			if (!username.equalsIgnoreCase("") && !userpass.equalsIgnoreCase("")) {
				UserModel b = us.getUser(username, userpass);
				us.releaseConnection();
				if (b != null) {
					request.getSession().setAttribute("Loginned", b);
					response.sendRedirect(request.getContextPath() + "/adv/admin/manager.jsp");
				} else {
					response.sendRedirect(request.getContextPath() + "/adv/home?err=notok");
				}
			} else {
				response.sendRedirect(request.getContextPath() + "/adv/home?err=value");
			}
		} else {
			response.sendRedirect(request.getContextPath() + "/adv/home?err=param");
		}
	}

}
